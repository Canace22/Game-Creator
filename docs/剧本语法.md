# 剧本语法参考

剧本编辑器使用纯文本格式，每行对应一种语法元素，实时解析为游戏节点结构。

---

## 语法速查

| 写法 | 说明 | 生成节点类型 |
|---|---|---|
| `# 场景名` | 切换场景（后续行使用此场景） | — |
| `角色名：台词` | 角色对话（中英文冒号均可） | dialogue |
| `旁白内容` | 无角色名的独白 / 旁白 | dialogue（无 speaker）|
| `? 提示语` | 选项节点的提示文字 | choice |
| `> 选项文字` | 紧跟在 `?` 之后，每行一个选项 | choice.choices[] |
| `END 结局描述` | 故事结局（不区分大小写） | end |
| `// 注释` | 注释行，不影响游戏 | 忽略 |
| 空行 | 分段，不影响游戏 | 忽略 |

---

## 详细说明

### `#` 场景切换

```
# 书房
```

- 后续所有节点使用「书房」场景，直到遇到下一个 `#` 行
- 首个 `#` 行同时作为**剧本标题**
- 场景背景可在右侧「角色 / 场景」面板中修改

### `角色名：台词` 对话节点

```
爱丽丝：（颤抖地）这……这是什么？
Bob: Hello world.
```

- 角色名与台词用**中文冒号 `：`** 或**英文冒号 `:`** 分隔均可
- 角色名限制：1–15 字，只含汉字、字母、数字、下划线、`·`，不含空格
- 首次出现的角色名**自动创建角色**，并分配颜色

### 旁白 / 无角色对话

```
深夜，书房中蜡烛摇曳。
信纸上写着：「你的记忆是假的。」
```

- 不含合法角色名前缀的行视为旁白，游戏中不显示角色名

### `?` + `>` 选项节点

```
? 爱丽丝：我应该怎么做？
> 立刻去找警察
> 独自调查
> 假装什么都没看见
```

- `?` 行是选项节点的提示文字（可选填角色名，写法同对话）
- `>` 行紧跟在 `?` 之后，每行一个选项
- 选项跳转目标需在右侧**节点面板**中手动连线（或由千问 AI 解析时自动处理）
- `>` 行之间可以不加空行

### `END` 结局节点

```
END 无论如何，真相即将揭晓。
END
```

- `END` 不区分大小写（`end`、`End` 均可）
- 结局描述可选，留空时游戏显示「故事结束」

### `//` 注释

```
// 这里是第一章
// TODO: 补充战斗场景
```

- 只支持整行注释，不支持行尾注释

---

## 完整示例

```
# 神秘信件

// 第一章：开始

旁白：深夜，书房中蜡烛摇曳。

爱丽丝：（颤抖着打开信封）这……这是什么？

信纸上写着：「你的记忆是假的。」

? 爱丽丝：我应该怎么做？
> 立刻去找警察
> 独自调查

# 警察局

旁白：爱丽丝走进了空旷的警察局。

警官：你说你的记忆是假的？这话是什么意思？

END 真相，就藏在那封信的背面。
```

---

## 节点自动链接规则

- 连续的 `dialogue` 节点自动首尾相连（无需手动设置「下一节点」）
- `choice` 节点的各选项跳转目标**不自动链接**，需在节点面板中手动指定
- `end` 节点无后继节点

---

## 千问 AI 辅助

点击工具栏「✨ 千问 AI」打开辅助面板：

| 功能 | 说明 |
|---|---|
| **续写剧情** | 输入提示词，AI 生成符合本语法的剧本文本并**追加**到编辑器末尾 |
| **润色扩写** | 将当前整个剧本发给千问润色，**替换**编辑器内容（建议先导出保存） |

API Key 在 [阿里云百炼控制台](https://bailian.console.aliyun.com/) 获取，使用 `qwen-plus` 模型，仅存储在本地浏览器。
